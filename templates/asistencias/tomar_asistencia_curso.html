{% extends "base_modern.html" %}
{% load static %}

{% block title %}Tomar Asistencia por Curso - ALCAL{% endblock %}

{% block content %}
<div class="container-fluid">

    <div class="glass-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="fw-bold text-white mb-1">Tomar Asistencia</h2>
                <p class="text-white-50 mb-0">Registro de asistencia grupal por curso</p>
            </div>
            <a href="/ingresar/" class="btn btn-light text-primary fw-bold">
                <i class="bi bi-arrow-left me-2"></i> Volver
            </a>
        </div>
    </div>

    <!-- Mensajes -->
    {% if messages %}
    {% for message in messages %}
    <div class="alert glass-alert text-white d-flex align-items-center mb-4 border-0 {% if message.tags == 'success' %}bg-success{% else %}bg-danger{% endif %}"
        style="--bs-bg-opacity: .2; backdrop-filter: blur(10px);">
        <i
            class="bi {% if message.tags == 'success' %}bi-check-circle{% else %}bi-exclamation-triangle{% endif %} me-3 fs-4"></i>
        <div>
            {{ message }}
        </div>
        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}

    <div class="row g-4">
        <!-- Formulario de Selección -->
        <div class="col-lg-8">
            <div class="glass-card h-100">
                <h5 class="fw-bold mb-4 text-primary">
                    <i class="bi bi-calendar-plus me-2"></i> Seleccionar Curso y Turno
                </h5>

                <form method="post" action="{% url 'lista_alumnos_curso' %}" class="needs-validation" novalidate>
                    {% csrf_token %}

                    <div class="row g-3">
                        <!-- Curso -->
                        <div class="col-md-6">
                            <label for="curso" class="form-label text-muted small fw-bold">CURSO</label>
                            <select class="form-select bg-light" id="curso" name="curso" required>
                                <option value="">Seleccionar curso...</option>
                                {% for curso in cursos %}
                                <option value="{{ curso.id }}">{{ curso.curso }} - {{ curso.carrera.nombre }}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">Por favor seleccione un curso.</div>
                        </div>

                        <!-- Turno -->
                        <div class="col-md-6">
                            <label for="turno" class="form-label text-muted small fw-bold">TURNO</label>
                            <select class="form-select bg-light" id="turno" name="turno" required>
                                <option value="">Seleccionar turno...</option>
                                {% for turno in turnos %}
                                <option value="{{ turno.id }}">
                                    {{ turno.get_nombre_display }} ({{ turno.hora_inicio }} - {{ turno.hora_fin }})
                                </option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">Por favor seleccione un turno.</div>
                        </div>

                        <!-- Fecha -->
                        <div class="col-md-6">
                            <label for="fecha" class="form-label text-muted small fw-bold">FECHA</label>
                            <input type="date" class="form-control bg-light" id="fecha" name="fecha"
                                value="{% now 'Y-m-d' %}" required>
                            <div class="invalid-feedback">Por favor seleccione una fecha.</div>
                        </div>

                        <!-- Botón -->
                        <div class="col-md-6 d-flex align-items-end">
                            <button type="submit" class="btn btn-premium w-100">
                                <i class="bi bi-list-check me-2"></i> Ver Lista de Alumnos
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Información de Códigos -->
        <div class="col-lg-4">
            <div class="glass-card h-100 bg-soft-primary">
                <h5 class="fw-bold mb-4 text-primary">
                    <i class="bi bi-info-circle me-2"></i> Códigos de Asistencia
                </h5>

                <div class="d-flex flex-column gap-3">
                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-success rounded-pill me-3" style="width: 30px;">P</span>
                        <small class="fw-bold text-muted">Presente</small>
                    </div>

                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-warning text-dark rounded-pill me-3" style="width: 30px;">t</span>
                        <small class="fw-bold text-muted">Tarde (< 15m)</small>
                    </div>

                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-warning text-dark rounded-pill me-3" style="width: 30px;">T</span>
                        <small class="fw-bold text-muted">Tarde (> 15m)</small>
                    </div>

                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-danger rounded-pill me-3" style="width: 30px;">A</span>
                        <small class="fw-bold text-muted">Ausente</small>
                    </div>

                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-info text-dark rounded-pill me-3" style="width: 30px;">r</span>
                        <small class="fw-bold text-muted">Retirado (< 15m)</small>
                    </div>

                    <div class="d-flex align-items-center bg-white p-2 rounded shadow-sm">
                        <span class="badge bg-secondary rounded-pill me-3" style="width: 30px;">R</span>
                        <small class="fw-bold text-muted">Retirado (> 15m)</small>
                    </div>
                </div>

                <div class="mt-4 p-3 bg-white rounded border border-primary border-opacity-10">
                    <small class="text-muted d-block">
                        <i class="bi bi-lightbulb-fill text-warning me-1"></i>
                        <strong>Tip:</strong> Los códigos T y R cuentan como media falta (0.5).
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="glass-card py-3">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                    <h6 class="mb-0 fw-bold text-muted">
                        <i class="bi bi-lightning-charge-fill text-warning me-2"></i> Acciones Rápidas
                    </h6>
                    <div class="d-flex gap-2">
                        <a href="{% url 'consultar_asistencia_curso' %}" class="btn btn-sm btn-light text-primary">
                            <i class="bi bi-search me-1"></i> Consultar
                        </a>
                        <a href="{% url 'cierre_diario_seleccion' %}" class="btn btn-sm btn-light text-warning">
                            <i class="bi bi-calendar-check me-1"></i> Cierre Diario
                        </a>
                        <a href="{% url 'admin:asistencias_asistencia_changelist' %}"
                            class="btn btn-sm btn-light text-secondary">
                            <i class="bi bi-gear me-1"></i> Admin
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Validación del formulario
    (function () {
        'use strict';
        window.addEventListener('load', function () {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function (form) {
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}