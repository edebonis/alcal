<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ALCAL Sistema Académico{% endblock %}</title>

    <!-- Favicon -->
    {% load static %}
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/alcal-premium.css' %}">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    {% block extra_css %}{% endblock %}
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon" style="background: white; padding: 6px; border-radius: 8px;">
                    <img src="{% static 'images/logo-alcal.png' %}" alt="Logo Sagrado Corazón"
                        style="width: 36px; height: 36px; object-fit: contain; display: block;">
                </div>
                <div class="logo-text">ALCAL</div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">
                        <i class="bi bi-grid-fill"></i> Dashboard
                    </a>
                </div>

                <div class="nav-label text-muted small fw-bold px-3 mt-3 mb-2">GESTIÓN ACADÉMICA</div>

                <div class="nav-item">
                    <a href="{% url 'asistencia_selector' %}"
                        class="nav-link {% if 'asistencia' in request.path %}active{% endif %}">
                        <i class="bi bi-clipboard-check"></i> Asistencias
                    </a>
                </div>
                <div class="nav-item">
                    <a href="{% url 'calificaciones_selector' %}"
                        class="nav-link {% if 'calificaciones' in request.path %}active{% endif %}">
                        <i class="bi bi-bar-chart-fill"></i> Calificaciones
                    </a>
                </div>

                {% if user.is_staff or user.is_superuser %}
                <div class="nav-item">
                    <a href="{% url 'observaciones' %}"
                        class="nav-link {% if 'observaciones' in request.path %}active{% endif %}">
                        <i class="bi bi-chat-square-text-fill"></i> Observaciones
                    </a>
                </div>

                <div class="nav-item">
                    <a href="{% url 'cierre_diario_seleccion' %}"
                        class="nav-link {% if 'cierre_diario' in request.path %}active{% endif %}">
                        <i class="bi bi-calendar-check-fill"></i> Cierre Diario
                    </a>
                </div>
                {% endif %}

                {% if user.is_superuser %}
                <div class="nav-label text-muted small fw-bold px-3 mt-3 mb-2">ADMINISTRACIÓN</div>

                <div class="nav-item">
                    <a href="{% url 'administracion:dashboard' %}" class="nav-link">
                        <i class="bi bi-sliders"></i> Gestión (CRUD)
                    </a>
                </div>

                <div class="nav-item">
                    <a href="/admin/" class="nav-link">
                        <i class="bi bi-gear-fill"></i> Panel Admin Django
                    </a>
                </div>
                {% endif %}
            </nav>

            <div class="sidebar-footer">
                {% if user.is_authenticated %}
                <div class="user-card">
                    <div class="user-avatar">
                        {{ user.username|make_list|first|upper }}
                    </div>
                    <div class="overflow-hidden">
                        <div class="fw-bold text-truncate">{{ user.username }}</div>
                        <div class="small text-muted">Conectado</div>
                    </div>
                    <a href="/admin/logout/" class="ms-auto text-danger" title="Cerrar Sesión">
                        <i class="bi bi-box-arrow-right"></i>
                    </a>
                </div>
                {% else %}
                <a href="/admin/login/" class="btn btn-premium w-100">
                    Iniciar Sesión
                </a>
                {% endif %}
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Toggle -->
            <button class="btn btn-light d-lg-none mb-3" id="sidebarToggle">
                <i class="bi bi-list fs-4"></i>
            </button>

            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sidebar Toggle Logic
        const sidebar = document.getElementById('sidebar');
        const toggle = document.getElementById('sidebarToggle');

        if (toggle) {
            toggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>

</html>